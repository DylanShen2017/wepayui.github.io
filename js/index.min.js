//SPA 按需加载页面
(function($) {
    var app = $.sammy('#app', function() {
        this.use('Template');

        this.get('#/', function(context) {
            context.app.swap('');
            $.each(this.items, function(i, item) {
                context.render('./templates/start.template')
                    .appendTo(context.$element());
            });
        });

        this.get('#/start/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/start.template', {})
                .appendTo(context.$element());
        });
        //组件
        this.get('#/font/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/font.template', {})
                .appendTo(context.$element());
        });
        this.get('#/logo/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/logo.template', {})
                .appendTo(context.$element());
        });
        this.get('#/icon/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/icon.template', {})
                .appendTo(context.$element());
        });
        this.get('#/button/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/button.template', {})
                .appendTo(context.$element());
        });
        this.get('#/list/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/list.template', {})
                .appendTo(context.$element());
        });
        this.get('#/input/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/input.template', {})
                .appendTo(context.$element());
        });
        this.get('#/dialog/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/dialog.template', {})
                .appendTo(context.$element());
        });
        //场景-收付款
        this.get('#/pay_scan_code/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/pay_scan_code.template', {})
                .appendTo(context.$element());
        });
        this.get('#/pay_select_money/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/pay_select_money.template', {})
                .appendTo(context.$element());
        });
        this.get('#/pay_input_money/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/pay_input_money.template', {})
                .appendTo(context.$element());
        });
        this.get('#/pay_detail/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/pay_detail.template', {})
                .appendTo(context.$element());
        });
        this.get('#/pay_record/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/pay_record.template', {})
                .appendTo(context.$element());
        });
        //场景-行业解决方案
        this.get('#/profession_park/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/profession_park.template', {})
                .appendTo(context.$element());
        });
        this.get('#/profession_traffic/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/profession_traffic.template', {})
                .appendTo(context.$element());
        });
        this.get('#/profession_hospital_card/', function(context) {
            var str = location.href.toLowerCase();
            context.app.swap('');
            context.render('./templates/profession_hospital_card.template', {})
                .appendTo(context.$element());
        });
        //左导航选中效果
        this.before('.*', function() {
            var hash = document.location.hash;
            $("#nav > ul").find("a").parent().removeClass("wepay-menu-item-selected");
            $("#nav > ul").find("a[href='" + hash + "']").parent().addClass("wepay-menu-item-selected");
            $$.report('keypoint', $("a[href='" + hash + "']").attr("hash-data"));
            wepay.wepayLoaidngShow();
        });
    });
    $(function() {
        app.run('#/start/');
    });

})(jQuery);

//页面功能点
var wepay = {
    //预加载
    wepayLoaidngHide: function() {
        $("#wepayLoaidng").addClass('hide');
    },
    wepayLoaidngShow: function() {
        $("#wepayLoaidng").removeClass('hide');
    },
    //操作提示
    tips: function(text) {
        $("body").find(".tips").remove().end().append("<div class='tips'>" + text + "</div>");
        setTimeout(function() {
            $(".tips").fadeOut(1000);
        }, 1000)
    },
    //判断是PC端还是移动端
    isPC: function() {
        var userAgentInfo = navigator.userAgent;
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) {
                flag = false;
                break;
            }
        }
        return flag;
    },
    //flash复制
    copyCode: function() {
        $(".copy-text").zclip({
            path: "./swf/ZeroClipboard.swf",
            copy: function() {
                return $(this).parent().next().text();
            },
            afterCopy: function() {
                wepay.tips("☺ 复制成功");
            }
        })
        $(".copy-html").zclip({
            path: "./swf/ZeroClipboard.swf",
            copy: function() {
                return $(this).html();
            },
            afterCopy: function() {
                wepay.tips("☺ 复制成功");
            }
        })
    },
    //高亮代码
    hljs: function() {
        $('pre code').each(function(i, block) {
            hljs.highlightBlock(block);
        });
    },
    //点击流统计
    dataclick: function() {
        $("[data-stat]").on("click", function(e) {
            $$.report('keypoint', $(e.target).attr("data-stat"));
        })
    },
    //左侧下拉菜单 点击事件
    pullDownMenu: function() {
        $('.wepay-menu-submenu-title').on('click', function() {
            var wepayMenuSubmenu = $(this).parent('.wepay-menu-submenu');
            if (wepayMenuSubmenu.hasClass('wepay-menu-submenu-open')) {
                wepayMenuSubmenu.removeClass('wepay-menu-submenu-open');
            } else {
                wepayMenuSubmenu.addClass('wepay-menu-submenu-open');
            }
        })
    },
    //窄屏是否显示左侧下拉菜单
    crtlNav: function(selector) {
        if ($(window).width() < 992) {
            if (selector.is(":hidden")) {
                selector.show();
                $("html").addClass("noscroll")
            } else {
                selector.hide();
                $("html").removeClass("noscroll")
            }
        }
    },
    //窄屏左导航小图标，控制左侧下拉菜单
    showNav: function() {
        var _nav = $("#nav")
        $("#wepay_hd_list").on('click', function() {
            wepay.crtlNav(_nav);
        })
        $('.wepay-menu-item').on('click', function() {
            wepay.crtlNav(_nav);
            wepay.toTop();
        })
        $(window).on('load resize', function() {
            $("body").removeClass("noscroll")
            if ($(window).width() >= 992) {
                _nav.show();
            } else if ($(window).width() < 992) {
                _nav.hide();
            }
        })
    },
    //返回页面顶部
    toTop: function() {
        $('html, body').animate({
            scrollTop: 0
        }, 500);
    },
    //SPA初始化
    spaInit: function() {
        wepay.dataclick();
        wepay.isPC() && wepay.copyCode();
        wepay.hljs();
        wepay.wepayLoaidngHide();
    },
    //框架初始化
    init: function() {
        wepay.showNav();
        wepay.pullDownMenu();
    }
}
wepay.init();